# –í—ã–≥—Ä—É–∑–∫–∞ –∂—É—Ä–Ω–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ 1–° –≤ Yandex Clickhouse

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–∞–º –Ω–∏–∂–µ:

* üìç –ê–Ω–¥—Ä–µ–π –û–≤—Å—è–Ω–∫–∏–Ω. [–í–µ–±–∏–Ω–∞—Ä –°–≤–µ—Ä—Ö–±—ã—Å—Ç—Ä—ã–π –ñ—É—Ä–Ω–∞–ª –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ 1C —Å –ø–æ–º–æ—â—å—é Yandex Clickhouse](https://youtu.be/HnZ0Of-YpW0) 
* üìç –ê–Ω–¥—Ä–µ–π –û–≤—Å—è–Ω–∫–∏–Ω. [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏ EvilBeaver/CllickHousePlayground](https://github.com/EvilBeaver/CllickHousePlayground)
* üìç –ï–≤–≥–µ–Ω–∏–π –ê–∫–ø–∞–µ–≤.  [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Exporter (–ï–≤akpaevj/OneSTools.EventLog)](https://github.com/akpaevj/OneSTools.EventLog)
* üìç [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Clickhouse Yandex](https://hub.docker.com/r/yandex/clickhouse-server)
* üìç [ODBC –¥—Ä–∞–π–≤–µ—Ä ClickHouse](https://github.com/ClickHouse/clickhouse-odbc)
* üìç [runtime .net 5](https://dotnet.microsoft.com/en-us/download/dotnet/5.0)

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ:**

## üî¥ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ andex Clickhouse + WEB –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ Docker

```yaml
version: "3.3"
services:
  clickhouse:
    image: yandex/clickhouse-server
    ulimits:
        nofile:
          soft: 262144
          hard: 262144 
    ports:
      - "8123:8123"
    volumes:
      - "clickhouse-data:/var/lib/clickhouse"
  click-ui:
    image: spoonest/clickhouse-tabix-web-client
    environment: 
      CH_NAME: 1C_Logs
      CH_HOST: localhost:8123
    depends_on:
        - clickhouse
    ports:
      - "8080:80"
volumes:
  clickhouse-data:      
```

## üî¥ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (–ë–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ - –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–∏–π –ñ–† –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã (EventLogExporter.exe/dll))

### üîπ 2.1 –°–∫–∞—á–∏–≤–∞–µ–º –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ –∏ –∫–æ–ø–∏—Ä—É–µ–º –≤ –∫–∞—Ç–∞–ª–æ–≥ —Å–µ—Ä–≤–µ—Ä–∞ 1–° (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ 'c:\EventLog') [(akpaevj/OneSTools.EventLog)](https://github.com/akpaevj/OneSTools.EventLog/releases)
### üîπ 2.2 –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (appsettings.json):
#### ‚ô®Ô∏è **–°–µ–∫—Ü–∏—è Manager:**
```yaml
"Manager": {
    "ClstFolders": [
      {
        "Folder": "C:\\\\Program Files\\1cv8\\srvinfo\\reg_1541",
        "Templates": [
          {
            "Mask": "upp_main",
            "Template": "[IBNAME]_el"
          }
        ]
      },
    ]
  }
```
–≥–¥–µ:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---------|:---------|
| **ClstFolders** | –ú–∞—Å—Å–∏–≤ –æ–ø–∏—Å–∞–Ω–∏–π –∫–∞—Ç–∞–ª–æ–≥–æ–≤ —Ä–∞–±–æ—á–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ (reg_*) |
| **Folder** | –ü—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É —Ä–∞–±–æ—á–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (reg_*) |
| **Templates**  | –®–∞–±–ª–æ–Ω—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑ –∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤ |
| **Mask** | –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –ø—Ä–∏–º–µ–Ω—è–µ–º–æ–µ –∫ –∏–º–µ–Ω–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã |
| **Template** | –®–∞–±–ª–æ–Ω –∏–º–µ–Ω–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –∂—É—Ä–Ω–∞–ª–∞. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤ —Å–µ–±–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é [IBNAME] |

#### ‚ô®Ô∏è **–°–µ–∫—Ü–∏—è Exporter:**
```yaml
"Exporter": {
    "StorageType": 1,
    "LogFolder": "C:\\Users\\akpaev.e.ENTERPRISE\\Desktop\\1Cv8Log",
    "Portion": 10000,
    "TimeZone": "Europe/Moscow",
    "WritingMaxDegreeOfParallelism": 1,
    "CollectedFactor": 2,
    "ReadingTimeout": 1,
    "LoadArchive": false
  }
```

–≥–¥–µ:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---------|:--------|
| StorageType | —Ç–∏–ø —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∂—É—Ä–Ω–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ú–æ–∂–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è: 1 - Clickhouse 2 - ElasticSearch |
| LogFolder | –ø—É—Ç—å –∫ –∫–∞—Ç–∞–ª–æ–≥—É –∂—É—Ä–Ω–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ 1–° |
| Portion | –†–∞–∑–º–µ—Ä –ø–æ—Ä—Ü–∏–∏, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º—ã–π –≤ –ë–î –∑–∞ –æ–¥–Ω—É –∏—Ç–µ—Ä–∞—Ü–∏—é (10000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| TimeZone | —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å (–≤ —Ñ–æ—Ä–º–∞—Ç–µ IANA Time Zone Database), –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø–∏—Å–∞–Ω –∂—É—Ä–Ω–∞–ª —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å —Å–∏—Å—Ç–µ–º—ã |
| WritingMaxDegreeOfParallelism | –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ –∑–∞–ø–∏—Å–∏ –≤ –°–£–ë–î. –¢.–∫. –≤ ClickHouse –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ BULK –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–º–µ–µ—Ç —Å–º—ã—Å–ª —Ç–æ–ª—å–∫–æ –¥–ª—è ElasticSearch. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - 1 |
| CollectedFactor | –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–º–µ—â–µ–Ω—ã –≤ –æ—á–µ—Ä–µ–¥—å –∑–∞–ø–∏—Å–∏. –ü—Ä–µ–¥–µ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–∞–≤–Ω–æ Portion * CollectedFactor. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - 2 |
| ReadingTimeout | —Ç–∞–π–º–∞—É—Ç —Å–±—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é - 1 —Å–µ–∫. |
| LoadArchive | –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Ä—Ö–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ true, –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è "live" —Ä–µ–∂–∏–º –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑ –ë–î |

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
–í—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –≤ 2 —Ä–µ–∂–∏–º–∞—Ö: –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ª–∏–±–æ –∫–∞–∫ —Å–ª—É–∂–±–∞ Windows/Linux. –î–ª—è —Ç–µ—Å—Ç–∞ –≤ –í–∞—à–µ–π —Å—Ä–µ–¥–µ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ *appsettings.json*, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å **runtime .net 5** (–ø—Ä–∏ –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏) –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å exe/dll. –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –°–£–ë–î –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ, –æ–Ω–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞–∫ —Å–ª—É–∂–±—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ (–Ω–∞–∑–≤–∞–Ω–∏–µ —Å–ª—É–∂–±—ã –∏ –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–≤–æ–∏):</br>

**Windows:**</br>
–ü–æ–º–µ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ –∫–æ–º–∞–Ω–¥—É:
```
sc create EventLogExporter binPath= "C:\elexporter\EventLogExporter.exe"
```
–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª—É–∂–±—É –∫–æ–º–∞–Ω–¥–æ–π:
```
sc start EventLogExporter
```



#### ‚ô®Ô∏è **–°–µ–∫—Ü–∏—è ClickHouse:**
```yaml
"ConnectionStrings": {
    "Default": "Host=localhost;Port=8123;Username=default;password=;Database=database_name;"
  }
```  

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: Username = 'default' –∏ Password = ''

–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ web  —Å–µ—Ä–≤–∏—Å—É –º–æ–∂–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:8123



## üî¥ 3. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ 1–° —á–µ—Ä–µ–∑ ODBC


1. [–°–∫–∞—á–∞—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ODBC –¥—Ä–∞–π–≤–µ—Ä ClickHouse](https://github.com/ClickHouse/clickhouse-odbc)
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–∫ –≤–Ω–µ—à–Ω–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫ 1–°.
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –∂—É—Ä–Ω–∞–ª–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –°–ö–î.